# 移动平台部署指南

## 📱 从电脑测试到手机部署的存档处理

### 1. 存档文件位置对比

| 平台 | 存档路径 | 说明 |
|------|----------|------|
| **Windows测试** | `%APPDATA%/Godot/app_userdata/MobileShooter/` | 开发测试环境 |
| **Android** | `/storage/emulated/0/Android/data/com.yourcompany.mobileShooter/files/` | 应用沙盒内 |
| **iOS** | `应用沙盒/Documents/` | 应用沙盒内 |

### 2. 部署步骤

#### 2.1 Android部署

**1. 配置Android权限**
```xml
<!-- android/app/src/main/AndroidManifest.xml -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.INTERNET" />
```

**2. 设置应用包名**
```gdscript
# project.godot
[application]
config/name="MobileShooter"
config/features=PackedStringArray("4.5", "Mobile")

[android]
package_name="com.yourcompany.mobileShooter"
```

**3. 导出设置**
- 选择Android平台
- 设置签名密钥
- 启用云存档功能（可选）

#### 2.2 iOS部署

**1. 配置iOS权限**
```gdscript
# project.godot
[ios]
bundle_identifier="com.yourcompany.mobileShooter"
```

**2. 导出设置**
- 选择iOS平台
- 设置开发者证书
- 配置应用沙盒权限

### 3. 存档系统适配

#### 3.1 自动平台检测
```gdscript
# 存档系统会自动检测平台
is_mobile_platform = OS.has_feature("mobile")
```

#### 3.2 移动平台特殊处理
- **权限检查** - 自动检查存储权限
- **空间管理** - 监控存储空间使用
- **云存档同步** - 支持云端备份（可选）

### 4. 云存档集成（推荐）

#### 4.1 启用云存档
```gdscript
# 在project.godot中添加云存档系统
CloudSaveSystem="*res://scripts/cloud_save_system.gd"
```

#### 4.2 云存档服务选择

**选项1：Godot云存档**
- 优点：原生支持，简单易用
- 缺点：功能有限

**选项2：Firebase**
- 优点：功能强大，跨平台
- 缺点：需要额外配置

**选项3：自建服务器**
- 优点：完全控制
- 缺点：需要服务器维护

### 5. 测试建议

#### 5.1 本地测试
```bash
# 在电脑上模拟移动平台
godot --headless --export-debug "Android" test.apk
```

#### 5.2 真机测试
1. 连接Android设备
2. 启用开发者选项和USB调试
3. 直接安装到设备测试

#### 5.3 存档测试
- 在电脑上创建存档
- 导出到手机
- 验证存档是否正常加载

### 6. 常见问题解决

#### 6.1 存档丢失
- 检查应用权限
- 确认存储空间充足
- 验证文件路径正确

#### 6.2 权限问题
- Android：检查Manifest权限
- iOS：确认沙盒权限

#### 6.3 云存档同步失败
- 检查网络连接
- 验证云服务配置
- 查看错误日志

### 7. 性能优化

#### 7.1 存档压缩
```gdscript
# 移动平台存档压缩
func compress_save_data(data: Dictionary) -> PackedByteArray:
    var json_string = JSON.stringify(data)
    return json_string.to_utf8_buffer().compress()
```

#### 7.2 增量保存
```gdscript
# 只保存变化的数据
func save_changes_only():
    var changed_data = get_changed_data()
    # 只保存变化的部分
```

### 8. 安全考虑

#### 8.1 数据加密
- 使用强加密密钥
- 定期更换密钥
- 防止逆向工程

#### 8.2 数据验证
- 添加校验和
- 防止数据篡改
- 版本兼容性检查

### 9. 发布前检查清单

- [ ] 存档功能在真机上测试通过
- [ ] 云存档同步正常
- [ ] 权限配置正确
- [ ] 性能表现良好
- [ ] 错误处理完善
- [ ] 用户界面适配

### 10. 后续维护

#### 10.1 版本升级
- 保持存档格式兼容
- 提供数据迁移方案
- 处理版本冲突

#### 10.2 监控和统计
- 存档成功率统计
- 云同步状态监控
- 用户反馈收集

## 🚀 总结

从电脑测试到手机部署，存档系统的核心逻辑保持不变，主要差异在于：

1. **文件路径** - Godot自动处理平台差异
2. **权限管理** - 移动平台需要额外权限
3. **云存档** - 推荐添加云端同步功能
4. **性能优化** - 移动平台需要更严格的内存管理

使用`user://`路径可以确保跨平台兼容性，Godot会自动处理不同平台的路径映射。

